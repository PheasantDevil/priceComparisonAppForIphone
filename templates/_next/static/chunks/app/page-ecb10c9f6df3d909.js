(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7328:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>I});var s=r(95155),a=r(12115);class l extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){if(this.state.hasError){var e;return(0,s.jsx)("div",{className:"p-6 rounded-lg bg-red-50 border border-red-200 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-red-600",children:"予期せぬエラーが発生しました"}),(0,s.jsx)("p",{className:"text-red-500",children:(null==(e=this.state.error)?void 0:e.message)||"不明なエラーが発生しました"}),(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium text-red-600 bg-white border border-red-600 rounded-md hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",onClick:this.handleRetry,children:"再試行"})]})})}return this.props.children}constructor(...e){super(...e),this.state={hasError:!1,error:null},this.handleRetry=()=>{this.setState({hasError:!1,error:null})}}}let i=()=>(0,s.jsx)("div",{className:"p-6 rounded-lg bg-gray-50 border border-gray-200 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-500"}),(0,s.jsx)("p",{className:"text-gray-600",children:"データを読み込み中..."})]})});var c=r(10351);let n=(0,a.memo)(function(e){let{series:t,selectedSeries:r,onSeriesToggle:l,onRefresh:i,loading:n}=e,d=(0,a.useCallback)((e,t)=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),l(t),alert(r.includes(t)?"".concat(t,"の選択を解除しました"):"".concat(t,"を選択しました")))},[l,r]);return(0,s.jsxs)("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200",role:"region","aria-label":"モデル選択",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-2",children:[(0,s.jsx)("label",{className:"font-bold text-sm md:text-base",id:"model-selector-label",children:"比較するモデルを選択："}),(0,s.jsx)("button",{onClick:i,disabled:n,className:"inline-flex items-center px-4 py-2 text-sm md:text-base font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"データを更新","aria-busy":n,children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",children:(0,s.jsx)(c.jTZ,{className:"h-4 w-4"})}),"更新中"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.jTZ,{className:"mr-2"}),"データを更新"]})})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row gap-4 flex-wrap",role:"group","aria-labelledby":"model-selector-label",children:t.map(e=>(0,s.jsxs)("label",{className:"inline-flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:r.includes(e),onChange:()=>l(e),onKeyPress:t=>d(t,e),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded","aria-label":"".concat(e,"を選択"),tabIndex:0}),(0,s.jsx)("span",{className:"text-sm md:text-base",children:e})]},e))})]})}),d=e=>"".concat(e.toLocaleString(),"円"),o=(e,t)=>t?"".concat((e/t*100).toFixed(1),"%"):"-",x=e=>e>0?"text-green-500":e<0?"text-red-500":"text-gray-500",m=(e,t)=>Math.round(t-.9*e),h=(e,t)=>t?e/t*100:0,u=(0,a.memo)(function(e){let{data:t,selectedSeries:r,loading:a,showRakutenColumns:l}=e;if(a)return(0,s.jsxs)("div",{className:"text-center py-8",role:"status","aria-label":"データを読み込み中",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto"}),(0,s.jsx)("p",{className:"mt-4",children:"データを読み込み中..."})]});if(0===r.length)return(0,s.jsx)("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-md",role:"status","aria-label":"モデルが選択されていません",children:"比較するモデルを選択してください"});let i=[];return r.forEach(e=>{let r=t[e];r&&r.prices&&Object.entries(r.prices).forEach(t=>{let[r,s]=t,a=m(s.official_price,s.kaitori_price),l=h(a,s.kaitori_price);i.push({series:e,capacity:r,official_price:s.official_price,kaitori_price:s.kaitori_price,price_diff:s.price_diff,rakuten_diff:a,rakuten_diff_percentage:l})})}),(0,s.jsx)("div",{className:"max-w-full overflow-x-auto",role:"region","aria-label":"価格比較テーブル",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"モデル"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"容量"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"公式価格"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"買取価格"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"差額"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"差額率"}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center",children:["楽天錬金時差額",(0,s.jsxs)("div",{className:"group relative ml-1",children:[(0,s.jsx)("div",{className:"cursor-help",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50",children:["買取価格 - (公式価格 \xd7 0.9)",(0,s.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-gray-900"})]})]})]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"楽天錬金差額率"})]})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(e=>{let t=x(e.price_diff);return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.series}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.capacity}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:d(e.official_price)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:d(e.kaitori_price)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right ".concat(t),children:d(e.price_diff)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right ".concat(t),children:o(e.price_diff,e.official_price)}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right ".concat(x(e.rakuten_diff)),children:d(e.rakuten_diff)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right ".concat(x(e.rakuten_diff)),children:o(e.rakuten_diff,e.kaitori_price)})]})]},"".concat(e.series,"-").concat(e.capacity))})})]})})});var p=r(23464),f=r(83540),g=r(41287),b=r(94754),j=r(96025),y=r(16238),N=r(94517),v=r(24026),w=r(62341),k=r(21374),_=r(49509);let S=e=>{let{series:t,capacity:r,days:l=14,height:i=400,className:c=""}=e,[n,d]=(0,a.useState)([]),[o,x]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{try{x(!0),h(null);let e=_.env.NEXT_PUBLIC_API_BASE_URL||"https://us-central1-price-comparison-app-463007.cloudfunctions.net",s=await p.A.get("".concat(e,"/get_price_history"),{params:{series:t,capacity:r,days:l}});d(s.data.history)}catch(e){console.error("Error fetching price history:",e),h("価格履歴の取得に失敗しました")}finally{x(!1)}},[t,r,l]);(0,a.useEffect)(()=>{u()},[t,r,l,u]);let S=e=>"\xa5".concat(e.toLocaleString()),E=e=>new Date(e).toLocaleDateString("ja-JP",{month:"short",day:"numeric"});return o?(0,s.jsx)("div",{className:"flex items-center justify-center ".concat(c),style:{height:i},children:(0,s.jsx)("div",{className:"text-gray-500",children:"読み込み中..."})}):m?(0,s.jsx)("div",{className:"flex items-center justify-center ".concat(c),style:{height:i},children:(0,s.jsx)("div",{className:"text-red-500",children:m})}):0===n.length?(0,s.jsx)("div",{className:"flex items-center justify-center ".concat(c),style:{height:i},children:(0,s.jsx)("div",{className:"text-gray-500",children:"価格履歴データがありません"})}):(0,s.jsxs)("div",{className:"w-full ".concat(c),children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-800",children:[t," ",r," 価格推移（過去",l,"日間）"]})}),(0,s.jsx)(f.u,{width:"100%",height:i,children:(0,s.jsxs)(g.Q,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(b.d,{strokeDasharray:"3 3"}),(0,s.jsx)(j.W,{dataKey:"date",tickFormatter:E,tick:{fontSize:12}}),(0,s.jsx)(y.h,{tickFormatter:S,tick:{fontSize:12}}),(0,s.jsx)(N.m,{formatter:e=>[S(e),"価格"],labelFormatter:e=>E(e)}),(0,s.jsx)(v.s,{}),(0,s.jsx)(w.G,{type:"monotone",dataKey:"price_avg",stroke:"#4CAF50",fill:"rgba(76, 175, 80, 0.1)",strokeWidth:3,name:"平均価格"}),(0,s.jsx)(k.N,{type:"monotone",dataKey:"price_max",stroke:"#FF9800",strokeWidth:2,dot:{fill:"#FF9800",strokeWidth:2,r:4},name:"最高価格"}),(0,s.jsx)(k.N,{type:"monotone",dataKey:"price_min",stroke:"#F44336",strokeWidth:2,dot:{fill:"#F44336",strokeWidth:2,r:4},name:"最低価格"})]})}),(0,s.jsxs)("div",{className:"mt-4 flex justify-center space-x-6 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded mr-2"}),(0,s.jsx)("span",{children:"平均価格"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-orange-500 rounded mr-2"}),(0,s.jsx)("span",{children:"最高価格"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded mr-2"}),(0,s.jsx)("span",{children:"最低価格"})]})]})]})},E={};async function C(e){let t="".concat("https://asia-northeast1-price-comparison-app-463007.cloudfunctions.net","/get_prices?series=").concat(encodeURIComponent(e)),r=E[t],s=Date.now();if(r&&s-r.timestamp<3e5)return r.data;let a=await fetch(t,{cache:"no-store"});if(!a.ok)throw Error("API fetch failed");let l=await a.json();return E[t]={data:l,timestamp:s},l}let F=["iPhone 16","iPhone 16 Pro","iPhone 16 Plus","iPhone 16 Pro Max","iPhone 16 e"],P="selected_iphone_models",B="show_rakuten_columns";function I(){let[e,t]=(0,a.useState)([]),[r,c]=(0,a.useState)({}),[d,o]=(0,a.useState)(!1),[x,m]=(0,a.useState)(null),[h,p]=(0,a.useState)(!1),[f,g]=(0,a.useState)("iPhone 16 Pro"),[b,j]=(0,a.useState)("1TB"),[y,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{{let{pathname:e}=window.location;if(e.includes("/?/")){let t=e.replace("/?/","/").replace(/~and~/g,"&");window.history.replaceState(null,"",t)}}},[]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem(P);if(e){let r=JSON.parse(e);Array.isArray(r)&&r.every(e=>F.includes(e))&&t(r)}let r=localStorage.getItem(B);r&&N(JSON.parse(r))}catch(e){console.error("Failed to load saved settings:",e),alert("設定の読み込みに失敗しました。デフォルト設定を使用します。")}},[]),(0,a.useEffect)(()=>{try{localStorage.setItem(P,JSON.stringify(e))}catch(e){console.error("Failed to save series:",e),alert("選択状態の保存に失敗しました。")}},[e]),(0,a.useEffect)(()=>{try{localStorage.setItem(B,JSON.stringify(y))}catch(e){console.error("Failed to save rakuten columns setting:",e),alert("楽天錬金列の設定保存に失敗しました。")}},[y]);let v=(0,a.useCallback)(async()=>{o(!0),m(null);try{let t={},r=e.map(e=>C(e)),s=await Promise.all(r);e.forEach((e,r)=>{t[e]=s[r]}),c(t)}catch(e){console.error("Failed to fetch data:",e),m(e instanceof Error?e:Error("データの取得に失敗しました")),alert("データの取得に失敗しました。")}finally{o(!1)}},[e]);(0,a.useEffect)(()=>{e.length>0&&v()},[e,v]);let w=(0,a.useCallback)(async()=>{Object.keys(E).forEach(e=>delete E[e]),await v(),alert("データを更新しました。")},[v]),k=(0,a.useCallback)(e=>{t(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),_=(0,a.useMemo)(()=>(0,s.jsx)(n,{series:F,selectedSeries:e,onSeriesToggle:k,onRefresh:w,loading:d}),[e,k,w,d]),I=(0,a.useMemo)(()=>(0,s.jsx)(u,{data:r,selectedSeries:e,loading:d,showRakutenColumns:y}),[r,e,d,y]),A=(0,a.useMemo)(()=>(0,s.jsxs)("div",{className:"mt-8 bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"価格推移グラフ"}),(0,s.jsx)("button",{onClick:()=>p(!h),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:h?"グラフを隠す":"グラフを表示"})]}),h&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"シリーズ"}),(0,s.jsx)("select",{value:f,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:F.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"容量"}),(0,s.jsxs)("select",{value:b,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"128GB",children:"128GB"}),(0,s.jsx)("option",{value:"256GB",children:"256GB"}),(0,s.jsx)("option",{value:"512GB",children:"512GB"}),(0,s.jsx)("option",{value:"1TB",children:"1TB"})]})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"過去14日間の価格推移を表示"})})]}),(0,s.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:(0,s.jsx)(S,{series:f,capacity:b,days:14,height:400,className:"w-full"})}),(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"グラフの見方"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"平均価格（緑）"}),": その日の平均買取価格"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"最高価格（オレンジ）"}),": その日の最高買取価格"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"最低価格（赤）"}),": その日の最低買取価格"]}),(0,s.jsx)("li",{children:"• データは毎日午前9時に自動更新されます"})]})]})]})]}),[h,f,b]);return(0,s.jsx)(l,{children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"iPhone 価格比較"}),(0,s.jsx)("div",{className:"space-y-4 mb-6",children:_}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("label",{className:"inline-flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:y,onChange:()=>N(!y),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded","aria-label":"楽天錬金列を表示"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"楽天錬金列を表示（楽天錬金時差額・楽天錬金差額率）"})]})}),d?(0,s.jsx)(i,{}):x?(0,s.jsxs)("div",{className:"p-4 rounded-md bg-red-50 border border-red-200 text-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-red-600 mb-2",children:"エラーが発生しました"}),(0,s.jsx)("p",{className:"text-red-500",children:x.message})]}):I]}),A]})})}},73940:(e,t,r)=>{Promise.resolve().then(r.bind(r,7328))}},e=>{var t=t=>e(e.s=t);e.O(0,[844,818,441,684,358],()=>t(73940)),_N_E=e.O()}]);